FactoryBot.define do
  factory :company do
    # String ID will be auto-generated by the model
    city
    sequence(:name) { |n| "Elite Sewer Solutions #{n}" }
    sequence(:phone) { |n| "(555) 555-#{format('%04d', n)}" }
    sequence(:email) { |n| "contact#{n}@elitesewerco.com" }
    sequence(:site) { |n| "https://www.elitesewerco#{n}.com" }
    street_address { '1234 Main St' }
    postal_code { '10001' }
    latitude { 28.5383 }
    longitude { -81.3792 }
    average_rating { 4.5 }
    total_reviews { 0 }
    verified_professional { true }
    working_hours do
      {
        'Sunday' => 'Open 24 hours',
        'Monday' => 'Open 24 hours',
        'Tuesday' => 'Open 24 hours',
        'Wednesday' => 'Open 24 hours',
        'Thursday' => 'Open 24 hours',
        'Friday' => 'Open 24 hours',
        'Saturday' => 'Open 24 hours'
      }
    end
    about do
      {
        'overview' => 'Full-service plumbing and sewer repair company',
        'experience_years' => 15,
        'team_size' => 10
      }
    end
    subtypes { %w[Plumbing Sewer Drain] }
    sequence(:logo_url) { |n| "https://cdn.example.com/logos/company#{n}.png" }
    sequence(:booking_appointment_link) { |n| "https://booking.example.com/company#{n}" }
    borough { 'Manhattan' }
    timezone { 'America/New_York' }

    trait :unverified do
      verified_professional { false }
    end

    trait :high_rated do
      average_rating { 5.0 }
      total_reviews { 50 }
    end

    trait :low_rated do
      average_rating { 2.5 }
      total_reviews { 10 }
    end

    trait :with_reviews do
      after(:create) do |company|
        create_list(:review, 5, company: company)
        company.update_rating!
      end
    end

    trait :with_service_categories do
      after(:create) do |company|
        create(:company_service, company: company, service_category: create(:service_category))
        create(:company_service, company: company, service_category: create(:service_category, :drain_cleaning))
      end
    end
  end
end
